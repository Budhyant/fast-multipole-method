FMM={};FMM.Field2=function(p,n,b,i,o){var t=p?Math.floor(Math.log(p)/Math.log(2)):0;var q=n?Math.floor(Math.log(n)/Math.log(2)):0;var m=function(w){return JSON.stringify([w.level,w.x,w.y])};var s=function(w){if(w.x!==void 0&&w.y!==void 0){return w}return{x:w[0],y:w[1],}};var e=function(x,w){return Math.sqrt(Math.pow(x.x-w.x,2)+Math.pow(x.y-w.y,2))};var h=function(w,x){return{x:x.x-w.x,y:x.y-w.y,}};var j=function(w){return{level:w.level+1,x:Math.floor(w.x/2),y:Math.floor(w.y/2),}};var u=function(z){var B={};for(var A=0,x=z.length;A<x;A++){var y=j(z[A]);B[m(y)]=y}var w=[];for(var y in B){w.push(B[y])}return w};var f=function(w){var z=[];for(var y=0;y<=1;y++){for(var x=0;x<=1;x++){z.push({level:w.level-1,x:w.x*2+y,y:w.y*2+x})}}return z};var a=function(w){return{x:(w.x+0.5)*Math.pow(2,w.level),y:(w.y+0.5)*Math.pow(2,w.level),}};var c=function(x,w){return{level:w,x:Math.floor(x.x/Math.pow(2,w)),y:Math.floor(x.y/Math.pow(2,w)),}};var d=function(y){var w=[];for(var x=t;x<q;x++){w.push(c(y,x))}return w};var v=function(B,A){var w=c(B,A);var z=[];for(var y=-1;y<=1;y++){for(var x=-1;x<=1;x++){z.push({level:A,x:w.x+y,y:w.y+x,})}}return z};var l=function(x){vicinities_=[];for(var w=t;w<q;w++){vicinities_.push(v(x,w))}return vicinities_};var r=function(B,A,y){var w={};var K=c(B,t);var x=l(B);var E={};E[m(K)]=K;for(var O=0,J=x.length;O<J;O++){var G=x[O];var z=u(G);for(var N=0,H=z.length;N<H;N++){var C=z[N];E[m(C)]=C;var I=f(C);for(var M=0,F=I.length;M<F;M++){var L=I[M];var D=m(L);if(E[D]!==void 0){continue}w[D]=s(y(h(a(L),B),A))}}}return w};var k=function(w,A,z){var y={};for(var x in w){y[x]=w[x]}for(var x in A){if(w[x]===void 0){y[x]=A[x];continue}y[x]=z(w[x],A[x])}return y};var g=function(B,C){var z=0;var A=d(C);for(var y=0,w=A.length;y<w;y++){var x=A[y];console.log(m(x));if(B[m(x)]===void 0){continue}z+=B[m(x)]}return z};this_={};this_._grid={};this_.value=function(w){return g(this_._grid,s(w))};this_.add_field=function(w){this_._grid=k(this_._grid,w._grid,i)};this_.remove_field=function(w){this_._grid=k(this_._grid,w._grid,o)};this_.add_particle=function(x,w){w=w||{};this_._grid=k(this_._grid,r(s(x),w,b),i)};this_.remove_particle=function(x,w){w=w||{};this_._grid=k(this_._grid,r(s(x),w,b),o)};return this_};FMM.ScalarField2=function(b,a,c){return FMM.Field2(b,a,c,function(e,d){return e+d},function(e,d){return e-d})};FMM.VectorField2=function(b,a,c){return FMM.Field2(b,a,c,function(e,d){return{x:e.x+d.x,y:e.y+d.y,}},function(e,d){return{x:e.x-d.x,y:e.y-d.y,}})};FMM.Field3=function(p,n,b,i,o){var t=p?Math.floor(Math.log(p)/Math.log(2)):0;var q=n?Math.floor(Math.log(n)/Math.log(2)):0;var m=function(w){return JSON.stringify([w.level,w.x,w.y,w.z])};var s=function(w){if(w.x!==void 0&&w.y!==void 0&&w.z!==void 0){return w}return{x:w[0],y:w[1],z:w[2],}};var e=function(x,w){return Math.sqrt(Math.pow(x.x-w.x,2)+Math.pow(x.y-w.y,2)+Math.pow(x.z-w.z,2))};var h=function(w,x){return{x:x.x-w.x,y:x.y-w.y,z:x.z-w.z,}};var j=function(w){return{level:w.level+1,x:Math.floor(w.x/2),y:Math.floor(w.y/2),z:Math.floor(w.z/2),}};var u=function(z){var B={};for(var A=0,x=z.length;A<x;A++){var y=j(z[A]);B[m(y)]=y}var w=[];for(var y in B){w.push(B[y])}return w};var f=function(w){var A=[];for(var z=0;z<=1;z++){for(var y=0;y<=1;y++){for(var x=0;x<=1;x++){A.push({level:w.level-1,x:w.x*2+z,y:w.y*2+y,z:w.z*2+x,})}}}return A};var a=function(w){return{x:(w.x+0.5)*Math.pow(2,w.level),y:(w.y+0.5)*Math.pow(2,w.level),z:(w.z+0.5)*Math.pow(2,w.level),}};var c=function(x,w){return{level:w,x:Math.floor(x.x/Math.pow(2,w)),y:Math.floor(x.y/Math.pow(2,w)),z:Math.floor(x.z/Math.pow(2,w)),}};var d=function(y){var w=[];for(var x=t;x<q;x++){w.push(c(y,x))}return w};var v=function(C,B){var w=c(C,B);var A=[];for(var z=-1;z<=1;z++){for(var y=-1;y<=1;y++){for(var x=-1;x<=1;x++){A.push({level:B,x:w.x+z,y:w.y+y,z:w.z+x,})}}}return A};var l=function(x){vicinities_=[];for(var w=t;w<q;w++){vicinities_.push(v(x,w))}return vicinities_};var r=function(B,A,y){var w={};var K=c(B,t);var x=l(B);var E={};E[m(K)]=K;for(var O=0,J=x.length;O<J;O++){var G=x[O];var z=u(G);for(var N=0,H=z.length;N<H;N++){var C=z[N];E[m(C)]=C;var I=f(C);for(var M=0,F=I.length;M<F;M++){var L=I[M];var D=m(L);if(E[D]!==void 0){continue}w[D]=s(y(h(a(L),B),A))}}}return w};var k=function(w,A,z){var y={};for(var x in w){y[x]=w[x]}for(var x in A){if(w[x]===void 0){y[x]=A[x];continue}y[x]=z(w[x],A[x])}return y};var g=function(B,C){var z=0;var A=d(C);for(var y=0,w=A.length;y<w;y++){var x=A[y];console.log(m(x));if(B[m(x)]===void 0){continue}z+=B[m(x)]}return z};this_={};this_._grid={};this_.value=function(w){return g(this_._grid,s(w))};this_.add_field=function(w){this_._grid=k(this_._grid,w._grid,i)};this_.remove_field=function(w){this_._grid=k(this_._grid,w._grid,o)};this_.add_particle=function(x,w){w=w||{};this_._grid=k(this_._grid,r(s(x),w,b),i)};this_.remove_particle=function(x,w){w=w||{};this_._grid=k(this_._grid,r(s(x),w,b),o)};return this_};FMM.ScalarField3=function(b,a,c){return FMM.Field3(b,a,c,function(e,d){return e+d},function(e,d){return e-d})};FMM.VectorField3=function(b,a,c){return FMM.Field3(b,a,c,function(e,d){return{x:e.x+d.x,y:e.y+d.y,z:e.z+d.z,}},function(e,d){return{x:e.x-d.x,y:e.y-d.y,z:e.z-d.z,}})};THREE==THREE||{};THREE.VectorField2=function(b,a,c){return FMM.Field2(b,a,function(d,e){c(new THREE.Vector2(d.x,d.y),e)},function(e,d){return THREE.Vector2.addVectors(e,d)},function(e,d){return THREE.Vector2.subVectors(e,d)})};THREE.VectorField3=function(b,a,c){return FMM.Field3(b,a,function(d,e){c(new THREE.Vector3(d.x,d.y,d.z),e)},function(e,d){return THREE.Vector3.addVectors(e,d)},function(e,d){return THREE.Vector3.subVectors(e,d)})};