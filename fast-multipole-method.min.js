"use strict";var FMM=(function(){var b={};var a=function(c,f,e){for(var d in f){if(c[d]===void 0){c[d]=f[d];continue}c[d]=e(c[d],f[d])}};b.Field2=function(r,p,d,l,q){var v=r?Math.floor(Math.log(r)/Math.log(2)):0;var s=p?Math.floor(Math.log(p)/Math.log(2)):0;var o=function(y){return y.level+","+y.x+","+y.y};var u=function(y){if(y.x!==void 0&&y.y!==void 0){return y}return{x:y[0],y:y[1],}};var g=function(z,y){return Math.sqrt(Math.pow(z.x-y.x,2)+Math.pow(z.y-y.y,2))};var k=function(y,z){return{x:z.x-y.x,y:z.y-y.y,}};var m=function(y){return{level:y.level+1,x:Math.floor(y.x/2),y:Math.floor(y.y/2),}};var w=function(B){var D={};for(var C=0,z=B.length;C<z;C++){var A=m(B[C]);D[o(A)]=A}var y=[];for(var A in D){y.push(D[A])}return y};var h=function(y){var B=[];for(var A=0;A<=1;A++){for(var z=0;z<=1;z++){B.push({level:y.level-1,x:y.x*2+A,y:y.y*2+z})}}return B};var c=function(y){return{x:(y.x+0.5)*Math.pow(2,y.level),y:(y.y+0.5)*Math.pow(2,y.level),}};var e=function(z,y){return{level:y,x:Math.floor(z.x/Math.pow(2,y)),y:Math.floor(z.y/Math.pow(2,y)),}};var f=function(A){var y=[];for(var z=v;z<s;z++){y.push(e(A,z))}return y};var x=function(D,C){var y=e(D,C);var B=[];for(var A=-1;A<=1;A++){for(var z=-1;z<=1;z++){B.push({level:C,x:y.x+A,y:y.y+z,})}}return B};var n=function(A){var y=[];for(var z=v;z<s;z++){y.push(x(A,z))}return y};var t=function(D,C,A){var y={};var M=e(D,v);var z=n(D);var G={};G[o(M)]=M;for(var Q=0,L=z.length;Q<L;Q++){var I=z[Q];var B=w(I);for(var P=0,J=B.length;P<J;P++){var E=B[P];G[o(E)]=E;var K=h(E);for(var O=0,H=K.length;O<H;O++){var N=K[O];var F=o(N);if(G[F]!==void 0){continue}y[F]=u(A(k(c(N),D),C))}}}return y};var i=function(D,E){var B=0;var C=f(E);for(var A=0,y=C.length;A<y;A++){var z=C[A];if(D[o(z)]===void 0){continue}if(B!==void 0){B=D[o(z)];continue}B=l(D[o(z)],B)}console.log(B);return B};var j={};j._grid={};j.value=function(y){return i(j._grid,u(y))};j.add_field=function(y){j._grid=a(j._grid,y._grid,l)};j.remove_field=function(y){j._grid=a(j._grid,y._grid,q)};j.add_particle=function(z,y){y=y||{};j._grid=a(j._grid,t(u(z),y,d),l)};j.remove_particle=function(z,y){y=y||{};j._grid=a(j._grid,t(u(z),y,d),q)};return j};b.ScalarField2=function(d,c,e){return b.Field2(d,c,e,function(g,f){return g+f},function(g,f){return g-f})};b.VectorField2=function(d,c,e){return b.Field2(d,c,e,function(g,f){return{x:g.x+f.x,y:g.y+f.y,}},function(g,f){return{x:g.x-f.x,y:g.y-f.y,}})};b.Field3=function(u,r,d,m,t){function l(E,B,D,C){return{level:E,x:B,y:D,z:C}}function A(B,D,C){return{x:B,y:D,z:C}}var x=u?Math.floor(Math.log(u)/Math.log(2)):0;var v=r?Math.floor(Math.log(r)/Math.log(2)):0;function q(B){return B.level+","+B.x+","+B.y+","+B.z}function w(B){if(B.x!==void 0&&B.y!==void 0&&B.z!==void 0){return B}return A(B[0],B[1],B[2])}function g(C,B){return Math.sqrt(Math.pow(C.x-B.x,2)+Math.pow(C.y-B.y,2)+Math.pow(C.z-B.z,2))}function k(B,C){return A(C.x-B.x,C.y-B.y,C.z-B.z)}function n(B){return l(B.level+1,Math.floor(B.x/2),Math.floor(B.y/2),Math.floor(B.z/2))}function y(E){var G={};for(var F=0,C=E.length;F<C;F++){var D=n(E[F]);G[q(D)]=D}var B=[];for(var D in G){B.push(G[D])}return B}function h(B){var F=[];for(var E=0;E<=1;E++){for(var D=0;D<=1;D++){for(var C=0;C<=1;C++){F.push(l(B.level-1,B.x*2+E,B.y*2+D,B.z*2+C))}}}return F}function c(B){return A((B.x+0.5)*Math.pow(2,B.level),(B.y+0.5)*Math.pow(2,B.level),(B.z+0.5)*Math.pow(2,B.level))}function e(C,B){return l(B,Math.floor(C.x/Math.pow(2,B)),Math.floor(C.y/Math.pow(2,B)),Math.floor(C.z/Math.pow(2,B)))}function f(D){var B=[];for(var C=x;C<v;C++){B.push(e(D,C))}return B}function z(H,G){var B=e(H,G);var F=[];for(var E=-1;E<=1;E++){for(var D=-1;D<=1;D++){for(var C=-1;C<=1;C++){F.push(l(G,B.x+E,B.y+D,B.z+C))}}}return F}function p(D){var B=[];for(var C=x;C<v;C++){B.push(z(D,C))}return B}function s(B,H,G,D,J){var S=e(H,x);var C=p(H);var M={};M[q(S)]=S;for(var W=0,R=C.length;W<R;W++){var O=C[W];var F=y(O);for(var V=0,P=F.length;V<P;V++){var I=F[V];M[q(I)]=I;var Q=h(I);for(var U=0,N=Q.length;U<N;U++){var T=Q[U];var K=q(T);if(M[K]!==void 0){continue}var L=w(D(k(c(T),H),G));var E=B[K];if(E===void 0){B[K]=L;continue}B[K]=J(E,L)}}}}function o(C,E,D){for(var B in E){if(C[B]===void 0){C[B]=E[B];continue}C[B]=D(C[B],E[B])}}function i(G,H){var E=void 0;var F=f(H);for(var D=0,B=F.length;D<B;D++){var C=F[D];if(G[q(C)]===void 0){continue}if(E===void 0){E=G[q(C)];continue}E=m(G[q(C)],E)}return E}var j={};j._grid={};j.value=function(C){var B=i(j._grid,w(C));return B};j.clear=function(){j._grid={}};j.add_field=function(B){o(j._grid,B._grid,m)};j.remove_field=function(B){o(j._grid,B._grid,t)};j.add_particle=function(C,B){B=B||{};s(j._grid,w(C),B,d,m)};j.remove_particle=function(C,B){B=B||{};s(j._grid,w(C),B,d,t)};return j};b.ScalarField3=function(d,c,e){return b.Field3(d,c,e,function(g,f){return g+f},function(g,f){return g-f})};b.VectorField3=function(d,c,e){return b.Field3(d,c,e,function(g,f){return Point(g.x+f.x,g.y+f.y,g.z+f.z)},function(g,f){return Point(g.x-f.x,g.y-f.y,g.z-f.z)})};return b})();THREE==THREE||{};THREE.VectorField2=function(b,a,c){return FMM.Field2(b,a,function(d,e){return c(new THREE.Vector2(d.x,d.y),e)},function(e,d){return THREE.Vector2.addVectors(e,d)},function(e,d){return THREE.Vector2.subVectors(e,d)})};THREE.VectorField3=function(b,a,c){return FMM.Field3(b,a,function(d,e){return c(new THREE.Vector3(d.x,d.y,d.z),e)},function(e,d){return new THREE.Vector3().addVectors(e,d)},function(e,d){return new THREE.Vector3().subVectors(e,d)})};